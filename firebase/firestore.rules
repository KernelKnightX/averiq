rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Career applications - allow create for anyone, read/write for authenticated users
    match /career_applications/{document} {
      allow create: if request.auth == null && request.resource.data.keys().hasAll(['name', 'email', 'phone', 'role', 'experience', 'skills', 'location', 'pincode', 'city', 'portfolio', 'resumeFileName', 'resumeStoragePath', 'resumeURL', 'status', 'createdAt']);
      allow read: if request.auth != null;
      allow write: if request.auth != null;
      allow update: if request.auth != null && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['status', 'reviewedAt', 'reviewedBy', 'notes']);
    }

    // Admin users collection
    match /admin_users/{document} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }

    // Contact submissions - allow create for anyone, read/write for authenticated admins
    match /contact_submissions/{document} {
      allow create: if request.auth == null && request.resource.data.keys().hasAll(['name', 'email', 'company', 'phone', 'message', 'status', 'submittedAt']);
      allow read: if request.auth != null && request.auth.token.admin == true;
      allow write: if request.auth != null && request.auth.token.admin == true;
      allow update: if request.auth != null && request.auth.token.admin == true && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['status', 'notes', 'respondedAt', 'respondedBy']);
    }

    // Application statistics
    match /stats/{document} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
  }
}